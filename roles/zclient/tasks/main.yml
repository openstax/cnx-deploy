---

# Install LibreOffice

- name: check for existing download
  stat:
    path: "/tmp/LibreOffice_4.1.6.2_Linux_x86-64_deb"
  register: libreoffice_download_location
  tags:
    - install-libreoffice

- name: unpack libreoffice tarball
  when: "not libreoffice_download_location.stat.exists"
  unarchive:
    src: "https://packages.cnx.org/deb/LibreOffice_4.1.6.2_Linux_x86-64_deb.tar.gz"
    remote_src: yes
    dest: "/tmp"
  tags:
    - install-libreoffice

- name: install libreoffice
  become: yes
  shell: "dpkg -i *.deb"
  args:
    chdir: "/tmp/LibreOffice_4.1.6.2_Linux_x86-64_deb/DEBS/"
  tags:
    - install-libreoffice

# +++
# Configure
# +++

- name: configure zclient in supervisor
  become: yes
  template:
    src: etc/supervisor/conf.d/zclients.conf
    dest: "/etc/supervisor/conf.d/zclients.conf"
    mode: 0644
  register: supervisor_conf_for_zclients
  notify:
    - reload supervisord

- name: restart zclients
  when: "{{ not supervisor_conf_for_zclients|changed }}"
  become: yes
  supervisorctl:
    name: "{{ item }}"
    state: restarted
  with_items: "[{% for i in range(0, hostvars[inventory_hostname].zclient_count|default(1), 1) %}'{{ 'zclient_instance{}'.format(i) }}',{% endfor %}]"
