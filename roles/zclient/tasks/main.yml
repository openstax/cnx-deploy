---

- name: configure zclient in supervisor
  become: yes
  template:
    src: etc/supervisor/conf.d/zclients.conf
    dest: "/etc/supervisor/conf.d/zclients.conf"
    mode: 0644
  register: supervisor_conf_for_zclients
  notify:
    - reload supervisord

- name: restart zclients
  when: "{{ not supervisor_conf_for_zclients|changed }}"
  become: yes
  supervisorctl:
    name: "{{ item }}"
    state: restarted
  with_items: "[{% for i in range(0, hostvars[inventory_hostname].zclient_count|default(1), 1) %}'{{ 'zclient_instance{}'.format(i) }}',{% endfor %}]"
